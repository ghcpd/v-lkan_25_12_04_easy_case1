{"repo":"astral-sh/uv","pull_number":15377,"instance_id":"astral-sh__uv-15377","issue_numbers":[15372],"base_commit_sha":"075291f23e88fa37f0aa2248c8864e4578814035","patch":"diff --git a/crates/uv/src/commands/project/init.rs b/crates/uv/src/commands/project/init.rs\nindex 98845d1f4..ccf5d9118 100644\n--- a/crates/uv/src/commands/project/init.rs\n+++ b/crates/uv/src/commands/project/init.rs\n@@ -769,6 +769,10 @@ impl InitProjectKind {\n     ) -> Result<()> {\n         fs_err::create_dir_all(path)?;\n \n+        // Initialize the version control system first so that Git configuration can properly\n+        // read conditional includes that depend on the repository path.\n+        init_vcs(path, vcs)?;\n+\n         // Do no fill in `authors` for non-packaged applications unless explicitly requested.\n         let author_from = author_from.unwrap_or_else(|| {\n             if package {\n@@ -828,9 +832,6 @@ impl InitProjectKind {\n         }\n         fs_err::write(path.join(\"pyproject.toml\"), pyproject)?;\n \n-        // Initialize the version control system.\n-        init_vcs(path, vcs)?;\n-\n         Ok(())\n     }\n \n@@ -855,6 +856,10 @@ impl InitProjectKind {\n \n         fs_err::create_dir_all(path)?;\n \n+        // Initialize the version control system first so that Git configuration can properly\n+        // read conditional includes that depend on the repository path.\n+        init_vcs(path, vcs)?;\n+\n         let author = get_author_info(path, author_from.unwrap_or_default());\n \n         // Create the `pyproject.toml`\n@@ -880,9 +885,6 @@ impl InitProjectKind {\n             generate_package_scripts(name, path, build_backend, true)?;\n         }\n \n-        // Initialize the version control system.\n-        init_vcs(path, vcs)?;\n-\n         Ok(())\n     }\n }\n","test_patch":"","problem_statement":"uv init should do git init before getting author information from git\n### Summary\n\nWhen using git to get the author information for `pyproject.toml`, I wondered why it was only getting my name but not my email address.\n\nI use `includeIf` in `.gitconfig` to set email address depending on folder (work/private):\n\n```gitconfig\n\n[user]\nname = My Name\n\n[includeIf \"gitdir:~/repositories/work/\"]\n  path = ./.gitconfig.work\n[includeIf \"gitdir:~/repositories/privat/\"]\n  path = ./.gitconfig.privat\n```\n\ngit will only include these files when called in a directory with a `.git` subdirectory, as the config states:\n\n\n> The data that follows the keyword gitdir: is used as a glob pattern. If the location of the .git directory matches the pattern, the include condition is met.\n> \n> The .git location may be auto-discovered, or come from $GIT_DIR environment variable. If the repository is auto-discovered via a .git file (e.g. from submodules, or a linked worktree), the .git location would be the final location where the .git directory is, not where the .git file is.\n> \n> \n\nWhen doing `uv init` it seems that the author information is collected from git before the git repository gets initialized which means it can't get the email information.\n\nIf possible it would be nice if uv could init git before collecting the author information from it so that the email address is included in `pyproject.toml`.\n\n### Example\n\n_No response_","pull_message":"Initialize Git prior to reading author\n## Summary\r\n\r\nCloses https://github.com/astral-sh/uv/issues/15372.\r\n","hints":[],"created_at":"2025-08-19T10:29:53Z","cursor":"Y3Vyc29yOnYyOpK5MjAyNS0wOC0xOVQxODoyOTo1MyswODowMM6kRPKi","merge_commit_sha":"c58192eebe45dabb0db15f4903aae611745e0019","test_files":[],"precommit_script":"","setup_command":"#!/usr/bin/env bash\nset -euo pipefail\n\n# Install pytest for running tests and generating JUnit XML report\npython -m pip install --upgrade pip\npython -m pip install -q pytest\n\n# Install packages that are used by tests across the repository\npython -m pip install -q keyring httpx\n\n# Ensure we have any additional common testing dependencies that may be needed by tests in this repo\n# (add more as discovered)\n\ncargo fetch --locked\n","test_command":"","additions":8,"deletions":6,"file_changes":1,"image":"acvdpwu2p001dcr.azurecr.io/astral-sh__uv-15377:20251201"}
