{"repo": "starship/starship", "pull_number": 4760, "instance_id": "starship__starship-4760", "issue_numbers": [4759], "base_commit_sha": "d4e664eda5ed06dfa91ae4e97d420afda38c30d9", "patch": "diff --git a/src/modules/package.rs b/src/modules/package.rs\nindex 7a2e88a9..d741ad1f 100644\n--- a/src/modules/package.rs\n+++ b/src/modules/package.rs\n@@ -105,7 +105,7 @@ fn get_gradle_version(context: &Context, config: &PackageConfig) -> Option<Strin\n     context\n         .read_file_from_pwd(\"gradle.properties\")\n         .and_then(|contents| {\n-            let re = Regex::new(r\"version=(?P<version>.*)\").unwrap();\n+            let re = Regex::new(r\"(?m)^\\s*version\\s*=\\s*(?P<version>.*)\").unwrap();\n             let caps = re.captures(&contents)?;\n             format_version(&caps[\"version\"], config.version_format)\n         }).or_else(|| {\n@@ -979,6 +979,18 @@ java {\n         expect_output(&project_dir, Some(\"v1.2.3\"), None);\n         project_dir.close()\n     }\n+    #[test]\n+    fn test_extract_grade_version_from_properties_with_comment_and_whitespace() -> io::Result<()> {\n+        let config_name = \"gradle.properties\";\n+        let config_content = \"\n+            # or use -Pversion=0.0.1\n+            version = 1.2.3\n+            \";\n+        let project_dir = create_project_dir()?;\n+        fill_config(&project_dir, config_name, Some(config_content))?;\n+        expect_output(&project_dir, Some(\"v1.2.3\"), None);\n+        project_dir.close()\n+    }\n \n     #[test]\n     fn test_extract_mix_version() -> io::Result<()> {\n", "test_patch": "", "problem_statement": "Getting a package version from gradle.properties is not implemented correctly\n#### Current Behavior\r\nCommented out lines in gradle.properties with 'version=' will be matched as defining a version. versions defined with whitespace between 'version' and '=' will not be extract properly.\r\n\r\n#### Expected Behavior\r\nComment lines should be ignored. Whitespace should be allowed on either side of '='.\r\n\r\n#### Additional context/Screenshots\r\nE.g. this content in a gradle.properties file should NOT set the version to 0.0.1\r\n```\r\n# Generally it is better to set the version only for release builds, build time\r\n# from command line using -Pversion=0.0.1\r\n```\r\n\r\n#### Possible Solution\r\nFix the regex on this line https://github.com/starship/starship/blob/master/src/modules/package.rs#L108\r\n\r\n#### Environment\r\n- Starship version: 1.12.0\r\n- zsh version: zsh 5.8.1 (x86_64-apple-darwin22.0)\r\n- Operating system: Mac OS 13.2.0\r\n- Terminal emulator: WarpTerminal v0.2022.12.13.08.04.stable_01\r\n- Git Commit Hash: \r\n- Branch/Tag: master\r\n- Rust Version: rustc 1.65.0 (897e37553 2022-11-02)\r\n- Rust channel: stable-x86_64-apple-darwin release\r\n- Build Time: 2022-12-13 16:12:55 +00:00\r\n", "pull_message": "fix(package): Improve regex for extracting gradle version from gradle.properties\n\r\n#### Description\r\nChanged regex to ```(?m)^\\s*version\\s*=\\s*(?P<version>.*)``` to account for comment lines and possible whitespace.\r\n\r\n#### Motivation and Context\r\nCloses #4759\r\n\r\n#### How Has This Been Tested?\r\nAdded test with build.gradle file that contains commented out ```version=``` that was picked up by previous regex and with whitespace around the '='\r\n\r\n- [x ] I have tested using **MacOS**\r\n- [ ] I have tested using **Linux**\r\n- [ ] I have tested using **Windows**\r\n\r\n#### Checklist:\r\n<!--- Go over all the following points, and put an `x` in all the boxes that apply. -->\r\n<!--- If you're unsure about any of these, don't hesitate to ask. We're here to help! -->\r\n- [ ] I have updated the documentation accordingly.\r\n- [x] I have updated the tests accordingly.\r\n", "hints": [], "created_at": "2022-12-26T03:25:19Z", "cursor": "Y3Vyc29yOnYyOpK5MjAyMi0xMi0yNlQxMToyNToxOSswODowMM5GLlUU", "merge_commit_sha": "9093891acbe2c86b1615c37386dadbb0cc632199", "test_files": [], "precommit_script": "", "setup_command": "#!/usr/bin/env bash\nset -euo pipefail\n\n# Minimal environment setup for running tests in this Rust repository\n# Do not use sudo in this script (per instructions)\n\necho \"Setting up environment for tests...\"\n\n# Update package lists if apt is available\nif command -v apt-get >/dev/null 2>&1; then\n  echo \"Detected apt-get, installing required packages: git, python3, python3-pip\"\n  # apt-get can be run without sudo in many CI environments where container runs as root\n  apt-get update -y\n  apt-get install -y git python3 python3-pip\nfi\n\n# Ensure Python tooling is available for converting test output to JUnit XML\nif command -v pip3 >/dev/null 2>&1; then\n  pip3 install --upgrade pip\n  pip3 install junit-xml\nfi\n\n# Install cargo helper tools if cargo is available\nif command -v cargo >/dev/null 2>&1; then\n  echo \"Cargo detected: installing cargo2junit as helper (best-effort)\"\n  # cargo install will place binaries in $HOME/.cargo/bin\n  # This is best-effort; if it fails, run_tests.sh falls back to a python converter\n  cargo install cargo2junit || true\nfi\n\necho \"Setup complete.\" \n\ncargo fetch --locked\n", "test_command": "", "additions": 13, "deletions": 1, "file_changes": 1, "image": "acvdpwu2p001dcr.azurecr.io/starship__starship-4760:20251201"}
