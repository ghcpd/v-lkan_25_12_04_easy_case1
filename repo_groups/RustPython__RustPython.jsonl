{"repo": "RustPython/RustPython", "pull_number": 1496, "instance_id": "RustPython__RustPython-1496", "issue_numbers": [1404], "base_commit_sha": "cc76649567cf42188cbcdf8eac8ca401120e0d22", "patch": "diff --git a/vm/src/obj/objtype.rs b/vm/src/obj/objtype.rs\nindex eaf6d187f..a3f781284 100644\n--- a/vm/src/obj/objtype.rs\n+++ b/vm/src/obj/objtype.rs\n@@ -199,6 +199,23 @@ impl PyClassRef {\n         Ok(())\n     }\n \n+    fn del_attr(self, attr_name: PyStringRef, vm: &VirtualMachine) -> PyResult<()> {\n+        if let Some(attr) = class_get_attr(&self.class(), attr_name.as_str()) {\n+            if let Some(ref descriptor) = class_get_attr(&attr.class(), \"__delete__\") {\n+                return vm\n+                    .invoke(descriptor, vec![attr, self.into_object()])\n+                    .map(|_| ());\n+            }\n+        }\n+\n+        if class_get_attr(&self, attr_name.as_str()).is_some() {\n+            self.attributes.borrow_mut().remove(attr_name.as_str());\n+            Ok(())\n+        } else {\n+            Err(vm.new_attribute_error(attr_name.as_str().to_string()))\n+        }\n+    }\n+\n     // This is used for class initialisation where the vm is not yet available.\n     pub fn set_str_attr<V: Into<PyObjectRef>>(&self, attr_name: &str, value: V) {\n         self.attributes\n@@ -255,8 +272,8 @@ pub fn init(ctx: &PyContext) {\n         \"__prepare__\" => ctx.new_rustfunc(PyClassRef::prepare),\n         \"__getattribute__\" => ctx.new_rustfunc(PyClassRef::getattribute),\n         \"__setattr__\" => ctx.new_rustfunc(PyClassRef::set_attr),\n+        \"__delattr__\" => ctx.new_rustfunc(PyClassRef::del_attr),\n         \"__subclasses__\" => ctx.new_rustfunc(PyClassRef::subclasses),\n-        \"__getattribute__\" => ctx.new_rustfunc(PyClassRef::getattribute),\n         \"__instancecheck__\" => ctx.new_rustfunc(PyClassRef::instance_check),\n         \"__subclasscheck__\" => ctx.new_rustfunc(PyClassRef::subclass_check),\n         \"__doc__\" => ctx.new_str(type_doc.to_string()),\n", "test_patch": "", "problem_statement": "An error occurs when deleting an attribute of a class.\n## Feature\r\n\r\n### Expected Result\r\n```\r\n>>> class C:\r\n...   x = 10\r\n... \r\n>>> del C.x\r\n>>> C.x\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\nAttributeError: type object 'C' has no attribute 'x'\r\n```\r\n\r\n### Actual Result\r\n```\r\n>>>>> class C:\r\n.....   x = 10\r\n..... \r\n>>>>> del C.x\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\nAttributeError: 'type' object has no attribute 'x'\r\n>>>>> C.x\r\n10\r\n```\r\nCan't delete attribute of class.", "pull_message": "Implement delattr for type object\nImplement delattr for type object\r\n\r\n### Before\r\n```\r\n>>>>> class C:\r\n.....   x = 10\r\n..... \r\n>>>>> del C.x\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\nAttributeError: 'type' object has no attribute 'x'\r\n>>>>> C.x\r\n10\r\n```\r\n\r\n### After\r\n```\r\n>>>>> class C:\r\n.....   x = 10\r\n.....\r\n>>>>> del C.x\r\n>>>>> C.x\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\nAttributeError: C has no attribute 'x'\r\n```\r\n\r\nFixed: #1404", "hints": [], "created_at": "2019-10-09T10:08:48Z", "cursor": "Y3Vyc29yOnYyOpK5MjAxOS0xMC0wOVQxODowODo0OCswODowMM4TcQA8", "merge_commit_sha": "e5c92d6fa2083471678181a5501660d9a7db8caf", "test_files": [], "precommit_script": "", "setup_command": "#!/usr/bin/env bash\nset -euo pipefail\n\n# Install Python test dependencies without using sudo or virtualenv\npython3 -m pip install --upgrade pip setuptools wheel\n\n# Install pytest and packages required by the repository test suites\n# Some tests have requirements files; install them if present\nif [ -f extra_tests/requirements.txt ]; then\n    python3 -m pip install -r extra_tests/requirements.txt\nfi\nif [ -f wasm/tests/requirements.txt ]; then\n    python3 -m pip install -r wasm/tests/requirements.txt\nfi\n\n# Also ensure pytest is installed (provides --junitxml)\npython3 -m pip install pytest\n\n# Ensure junit xml support (pytest has it builtin) and any useful plugins\npython3 -m pip install junit-xml || true\n\n# Print installed packages for debugging\npython3 -m pip freeze\n\ncargo fetch --locked\n", "test_command": "", "additions": 18, "deletions": 1, "file_changes": 1, "image": "acvdpwu2p001dcr.azurecr.io/rustpython__rustpython-1496:20251201"}
{"repo": "RustPython/RustPython", "pull_number": 3472, "instance_id": "RustPython__RustPython-3472", "issue_numbers": [3468], "base_commit_sha": "9fb70707c4803f9f6d79dd4c8077bd16f0a9be45", "patch": "diff --git a/vm/src/builtins/slice.rs b/vm/src/builtins/slice.rs\nindex 68e5d6886..add827d7d 100644\n--- a/vm/src/builtins/slice.rs\n+++ b/vm/src/builtins/slice.rs\n@@ -368,13 +368,15 @@ impl SaturatedSliceIter {\n \n impl Iterator for SaturatedSliceIter {\n     type Item = usize;\n+\n     fn next(&mut self) -> Option<Self::Item> {\n         if self.len == 0 {\n             return None;\n         }\n         self.len -= 1;\n         let ret = self.index as usize;\n-        self.index += self.step;\n+        // SAFETY: if index is overflowed, len should be zero\n+        self.index = self.index.wrapping_add(self.step);\n         Some(ret)\n     }\n }\n", "test_patch": "", "problem_statement": "SaturatedSliceIter::next has overflow bug\n```sh\r\n$ cargo run Lib/test/test_list.py -v -k test_extendedslicing\r\n\r\ntest_extendedslicing (__main__.ListTest) ... thread 'main' panicked at 'attempt to add with overflow', vm/src/builtins/slice.rs:377:9\r\n```\r\n\r\nProbably introduced in #3340 ", "pull_message": "fix #3468 SaturatedSliceIter overflow\nfixes #3468 ", "hints": [], "created_at": "2021-11-28T09:18:32Z", "cursor": "Y3Vyc29yOnYyOpK5MjAyMS0xMS0yOFQxNzoxODozMiswODowMM4vF2Dz", "merge_commit_sha": "e740de697b1dfe6ae2e3841a0d7ae55e1e6bec12", "test_files": [], "precommit_script": "", "setup_command": "#!/usr/bin/env bash\nset -euo pipefail\n\n# Install Python test dependencies without using sudo or virtualenv\npython3 -m pip install --upgrade pip setuptools wheel\n\n# Install pytest and packages required by the repository test suites\n# Some tests have requirements files; install them if present\nif [ -f extra_tests/requirements.txt ]; then\n    python3 -m pip install -r extra_tests/requirements.txt\nfi\nif [ -f wasm/tests/requirements.txt ]; then\n    python3 -m pip install -r wasm/tests/requirements.txt\nfi\n\n# Also ensure pytest is installed (provides --junitxml)\npython3 -m pip install pytest\n\n# Ensure junit xml support (pytest has it builtin) and any useful plugins\npython3 -m pip install junit-xml || true\n\n# Print installed packages for debugging\npython3 -m pip freeze\n\ncargo fetch --locked\n", "test_command": "", "additions": 3, "deletions": 1, "file_changes": 1, "image": "acvdpwu2p001dcr.azurecr.io/rustpython__rustpython-3472:20251201"}
