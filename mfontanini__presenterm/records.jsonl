{"repo":"mfontanini/presenterm","pull_number":34,"instance_id":"mfontanini__presenterm-34","issue_numbers":[32],"base_commit_sha":"8215449d5c1d9f741f16971797e5c2c6ee904583","patch":"diff --git a/src/builder.rs b/src/builder.rs\nindex 4d73f2e..c9787be 100644\n--- a/src/builder.rs\n+++ b/src/builder.rs\n@@ -281,13 +281,7 @@ impl<'a> PresentationBuilder<'a> {\n     }\n \n     fn process_pause(&mut self) {\n-        // Remove the last line, if any, if the previous element is a list. This allows each\n-        // element in a list showing up without newlines in between..\n-        if matches!(self.slide_state.last_element, LastElement::List { .. })\n-            && matches!(self.chunk_operations.last(), Some(RenderOperation::RenderLineBreak))\n-        {\n-            self.chunk_operations.pop();\n-        }\n+        self.slide_state.last_chunk_ended_in_list = matches!(self.slide_state.last_element, LastElement::List { .. });\n \n         let chunk_operations = mem::take(&mut self.chunk_operations);\n         self.slide_chunks.push(SlideChunk::new(chunk_operations));\n@@ -357,10 +351,19 @@ impl<'a> PresentationBuilder<'a> {\n     fn push_image(&mut self, path: PathBuf) -> Result<(), BuildError> {\n         let image = self.resources.image(&path)?;\n         self.chunk_operations.push(RenderOperation::RenderImage(image));\n+        self.chunk_operations.push(RenderOperation::SetColors(self.theme.default_style.colors.clone()));\n         Ok(())\n     }\n \n     fn push_list(&mut self, list: Vec<ListItem>) {\n+        let last_chunk_operation = self.slide_chunks.last().and_then(|chunk| chunk.iter_operations().last());\n+        // If the last chunk ended in a list, pop the newline so we get them all next to each\n+        // other.\n+        if matches!(last_chunk_operation, Some(RenderOperation::RenderLineBreak))\n+            && self.slide_state.last_chunk_ended_in_list\n+        {\n+            self.slide_chunks.last_mut().unwrap().pop_last();\n+        }\n         // If this chunk just starts (because there was a pause), pick up from the last index.\n         let start_index = match self.slide_state.last_element {\n             LastElement::List { last_index } if self.chunk_operations.is_empty() => last_index + 1,\n@@ -587,6 +590,7 @@ impl<'a> PresentationBuilder<'a> {\n struct SlideState {\n     ignore_element_line_break: bool,\n     needs_enter_column: bool,\n+    last_chunk_ended_in_list: bool,\n     last_element: LastElement,\n     layout: LayoutState,\n }\ndiff --git a/src/presentation.rs b/src/presentation.rs\nindex 1b4ae34..1c789c9 100644\n--- a/src/presentation.rs\n+++ b/src/presentation.rs\n@@ -223,6 +223,10 @@ impl SlideChunk {\n     pub(crate) fn iter_operations(&self) -> impl Iterator<Item = &RenderOperation> + Clone {\n         self.0.iter()\n     }\n+\n+    pub(crate) fn pop_last(&mut self) -> Option<RenderOperation> {\n+        self.0.pop()\n+    }\n }\n \n /// The metadata for a presentation.\n","test_patch":"","problem_statement":"List | pause | paragraph combo removes needed line break\nThe following presentation gets the necessary line break that should normally be in between the list and the paragraph removed and looks off.\r\n\r\n```markdown\r\n* Hi\r\n<!-- pause -->\r\nmom\r\n```","pull_message":"Don't remove newlines after every list + pause\nThis makes it so that a list + pause combo doesn't always pop the newline as this only should be the behavior if the thing right after is a list.\r\n\r\nFixes #32.","hints":[],"created_at":"2023-11-02T00:01:21Z","cursor":"Y3Vyc29yOnYyOpK5MjAyMy0xMS0wMlQwODowMToyMSswODowMM5eYdzD","merge_commit_sha":"b252b2ad9d7e32991d0575f0140294fdedb0847a","test_files":[],"precommit_script":"","setup_command":"#!/usr/bin/env bash\nset -euo pipefail\n\n# Setup script for the presenterm repository.\n# Installs tools required to run tests and generate a JUnit XML report.\n\n# Ensure cargo is available (rust toolchain). If not, try to install via rustup.\nif ! command -v cargo >/dev/null 2>&1; then\n    echo \"cargo not found. Installing rustup...\"\n    # Non-interactive rustup installation\n    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y\n    # shellcheck source=/dev/null\n    source \"$HOME/.cargo/env\"\nfi\n\n# Ensure cargo bin dir is in PATH\nexport PATH=\"$HOME/.cargo/bin:$PATH\"\n\n# Install cargo2junit to convert cargo test output to JUnit XML\nif ! command -v cargo2junit >/dev/null 2>&1; then\n    echo \"Installing cargo2junit...\"\n    cargo install cargo2junit\nfi\n\necho \"Setup complete. cargo: $(cargo --version)\" \n\ncargo fetch --locked\n","test_command":"","additions":15,"deletions":7,"file_changes":2,"image":"acvdpwu2p001dcr.azurecr.io/mfontanini__presenterm-34:20251201"}
